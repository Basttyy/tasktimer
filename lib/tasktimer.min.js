!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("tasktimer",[],e):"object"==typeof exports?exports.tasktimer=e():t.tasktimer=e()}(this,function(){return function(n){var i={};function r(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=n,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="lib/",r(r.s=0)}([function(t,n,e){"use strict";function i(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}Object.defineProperty(n,"__esModule",{value:!0}),i(e(5)),i(e(7))},function(t,s,e){"use strict";(function(i,e){Object.defineProperty(s,"__esModule",{value:!0});var n=Object.prototype,r="undefined"!=typeof window,o={BROWSER:r,NODE:!r,type:function(t){return n.toString.call(t).match(/\s(\w+)/i)[1].toLowerCase()},isset:function(t){return null!=t},ensureArray:function(t){return o.isset(t)?Array.isArray(t)?t:[t]:[]},getNumber:function(t,e,n){return"number"==typeof t?t<e?e:t:n},getBool:function(t,e){return"boolean"!=typeof t?e:t},setImmediate:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return r?setTimeout(t.apply(null,e),0):i.apply(void 0,[t].concat(e))},clearImmediate:function(t){if(t)return r?clearTimeout(t):void e(t)},isPromise:function(t){return t&&"promise"===o.type(t)&&"function"==typeof t.then}};s.utils=o}).call(this,e(2).setImmediate,e(2).clearImmediate)},function(t,r,o){(function(t){var e=void 0!==t&&t||"undefined"!=typeof self&&self||window,n=Function.prototype.apply;function i(t,e){this._id=t,this._clearFn=e}r.setTimeout=function(){return new i(n.call(setTimeout,e,arguments),clearTimeout)},r.setInterval=function(){return new i(n.call(setInterval,e,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(t){t&&t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(e,this._id)},r.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},r.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},r._unrefActive=r.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},o(6),r.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,r.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,o(3))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var a,c=[],l=!1,f=-1;function p(){l&&a&&(l=!1,a.length?c=a.concat(c):f=-1,c.length&&h())}function h(){if(!l){var t=u(p);l=!0;for(var e=c.length;e;){for(a=c,c=[];++f<e;)a&&a[f].run();f=-1,e=c.length}a=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function d(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new m(t,e)),1!==c.length||l||u(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),o=n(1),s=Object.freeze({enabled:!0,tickDelay:0,tickInterval:1,totalRuns:null,startDate:null,stopDate:null,immediate:!1,removeOnCompleted:!1,callback:null}),u=function(){function t(t){this._init(t)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._.enabled},set:function(t){this._.enabled=o.utils.getBool(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tickDelay",{get:function(){return this._.tickDelay},set:function(t){this._.tickDelay=o.utils.getNumber(t,0,s.tickDelay)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tickInterval",{get:function(){return this._.tickInterval},set:function(t){this._.tickInterval=o.utils.getNumber(t,1,s.tickInterval)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalRuns",{get:function(){return this._.totalRuns},set:function(t){this._.totalRuns=o.utils.getNumber(t,0,s.totalRuns)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"immediate",{get:function(){return this._.immediate},set:function(t){this._.immediate=o.utils.getBool(t,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentRuns",{get:function(){return this._.currentRuns},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var t=this._.timeOnFirstRun||0,e=this._.timeOnLastRun||0;return Object.freeze({started:t,stopped:e,elapsed:e-t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"callback",{get:function(){return this._.callback},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"removeOnCompleted",{get:function(){return this._.removeOnCompleted},set:function(t){this._.removeOnCompleted=o.utils.getBool(t,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"completed",{get:function(){return!!this._markedCompleted||Boolean(this.totalRuns&&this.currentRuns>=this.totalRuns||this._.stopDate&&Date.now()>=this._.stopDate)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canRunOnTick",{get:function(){if(this._markedCompleted)return!1;var t=this._.startDate?Math.ceil((Date.now()-Number(this._.startDate))/this._timer.interval):this._timer.tickCount,e=!this._.startDate||Date.now()>=this._.startDate,n=t>=this.tickDelay&&(t-this.tickDelay)%this.tickInterval==0;return Boolean(e&&n)},enumerable:!0,configurable:!0}),t.prototype.reset=function(t){if(this._.currentRuns=0,t){var e=t.id;if(e&&e!==this.id)throw new Error("Cannot change ID of a task.");t.id=this.id,this._init(t)}return this},t.prototype.toJSON=function(){var t=i({},this._);return delete t.callback,t},t.prototype._setTimer=function(t){this._timer=t},t.prototype._emit=function(t,e){var n={type:t,source:this};e instanceof Error?n.error=e:n.data=e,this._timer.emit(t,n)},t.prototype._done=function(){this.completed&&(this._markedCompleted=!0,this._.timeOnLastRun=Date.now(),this._timer._taskCompleted(this))},t.prototype._execCallback=function(){var e=this;try{var t=this.callback.apply(this,[this,function(){return e._done()}]);2<=this.callback.length||(o.utils.isPromise(t)?t.then(function(){e._done()}).catch(function(t){e._emit(r.TaskTimer.EventType.TASK_ERROR,t)}):this._done())}catch(t){this._emit(r.TaskTimer.EventType.TASK_ERROR,t)}},t.prototype._run=function(t){var e=this;this.enabled&&!this._markedCompleted&&(0===this.currentRuns&&(this._.timeOnFirstRun=Date.now()),this._.currentRuns++,t(),this.immediate?o.utils.setImmediate(function(){return e._execCallback()}):this._execCallback())},t.prototype._init=function(t){if(!t||!t.id)throw new Error("A unique task ID is required.");if("function"!=typeof t.callback)throw new Error("A callback function is required for a task to run.");var e=t.startDate,n=t.stopDate;if(e&&n&&n<=e)throw new Error("Task start date cannot be the same or after stop date.");this._markedCompleted=!1,this._=i({currentRuns:0},s),this._.id=String(t.id),this._.callback=t.callback,this._.startDate=t.startDate||null,this._.stopDate=t.stopDate||null,this.enabled=t.enabled,this.tickDelay=t.tickDelay,this.tickInterval=t.tickInterval,this.totalRuns=t.totalRuns,this.immediate=t.immediate,this.removeOnCompleted=t.removeOnCompleted},t}();e.Task=u},function(t,e,n){(function(t,m){!function(n,i){"use strict";if(!n.setImmediate){var r,o,e,s,t,u=1,a={},c=!1,l=n.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(n);f=f&&f.setTimeout?f:n,r="[object process]"==={}.toString.call(n.process)?function(t){m.nextTick(function(){h(t)})}:function(){if(n.postMessage&&!n.importScripts){var t=!0,e=n.onmessage;return n.onmessage=function(){t=!1},n.postMessage("","*"),n.onmessage=e,t}}()?(s="setImmediate$"+Math.random()+"$",t=function(t){t.source===n&&"string"==typeof t.data&&0===t.data.indexOf(s)&&h(+t.data.slice(s.length))},n.addEventListener?n.addEventListener("message",t,!1):n.attachEvent("onmessage",t),function(t){n.postMessage(s+t,"*")}):n.MessageChannel?((e=new MessageChannel).port1.onmessage=function(t){h(t.data)},function(t){e.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(o=l.documentElement,function(t){var e=l.createElement("script");e.onreadystatechange=function(){h(t),e.onreadystatechange=null,o.removeChild(e),e=null},o.appendChild(e)}):function(t){setTimeout(h,0,t)},f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return a[u]=i,r(u),u++},f.clearImmediate=p}function p(t){delete a[t]}function h(t){if(c)setTimeout(h,0,t);else{var e=a[t];if(e){c=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}(e)}finally{p(t),c=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(3),n(4))},function(t,f,p){"use strict";(function(e){var i,t=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(f,"__esModule",{value:!0});var n,r,o,s=p(8),u=p(0),a=p(1),c=Object.freeze({interval:1e3,precision:!0,stopOnCompleted:!1}),l=function(i){function r(t){var e=i.call(this)||this;e._timeoutRef=null,e._immediateRef=null,e._runCount=0,e._reset(),e._.opts={};var n="number"==typeof t?{interval:t}:t||{};return e.interval=n.interval,e.precision=n.precision,e.stopOnCompleted=n.stopOnCompleted,e}return t(r,i),Object.defineProperty(r.prototype,"interval",{get:function(){return this._.opts.interval},set:function(t){this._.opts.interval=a.utils.getNumber(t,20,c.interval)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"precision",{get:function(){return this._.opts.precision},set:function(t){this._.opts.precision=a.utils.getBool(t,c.precision)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stopOnCompleted",{get:function(){return this._.opts.stopOnCompleted},set:function(t){this._.opts.stopOnCompleted=a.utils.getBool(t,c.stopOnCompleted)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"state",{get:function(){return this._.state},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"time",{get:function(){var t=this.state!==r.State.STOPPED?Date.now():this._.stopTime;return Object.freeze({started:this._.startTime,stopped:this._.stopTime,elapsed:t-this._.startTime})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tickCount",{get:function(){return this._.tickCount},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"taskCount",{get:function(){return Object.keys(this._.tasks).length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"taskRunCount",{get:function(){return this._.taskRunCount},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"runCount",{get:function(){return this._runCount},enumerable:!0,configurable:!0}),r.prototype.get=function(t){return this._.tasks[t]||null},r.prototype.add=function(t){var e=this;if(!a.utils.isset(t))throw new Error("Either a task, task options or a callback is required.");return a.utils.ensureArray(t).forEach(function(t){return e._add(t)}),this},r.prototype.remove=function(t){var e="string"==typeof t?t:t.id;if(t=this.get(e),!e||!t)throw new Error("No tasks exist with ID: '"+e+"'.");return t.completed&&0<this._.completedTaskCount&&this._.completedTaskCount--,this._.tasks[e]=null,delete this._.tasks[e],this._emit(r.EventType.TASK_REMOVED,t),this},r.prototype.start=function(){return this._stop(),this._.state=r.State.RUNNING,this._runCount++,this._.tickCount=0,this._.taskRunCount=0,this._.stopTime=0,this._markTime(),this._.startTime=Date.now(),this._emit(r.EventType.STARTED),this._run(),this},r.prototype.pause=function(){return this.state!==r.State.RUNNING||(this._stop(),this._.state=r.State.PAUSED,this._emit(r.EventType.PAUSED)),this},r.prototype.resume=function(){return this.state===r.State.IDLE?this.start():this.state!==r.State.PAUSED||(this._runCount++,this._markTime(),this._.state=r.State.RUNNING,this._emit(r.EventType.RESUMED),this._run()),this},r.prototype.stop=function(){return this.state!==r.State.RUNNING||(this._stop(),this._.stopTime=Date.now(),this._.state=r.State.STOPPED,this._emit(r.EventType.STOPPED)),this},r.prototype.reset=function(){return this._reset(),this._emit(r.EventType.RESET),this},r.prototype._emit=function(t,e){var n={type:t,source:this,data:e};return this.emit(t,n)},r.prototype._add=function(t){if("function"==typeof t&&(t={callback:t}),"object"!==a.utils.type(t)||t.id||(t.id=this._getUniqueTaskID()),this.get(t.id))throw new Error("A task with id '"+t.id+"' already exists.");var e=t instanceof u.Task?t:new u.Task(t);return e._setTimer(this),this._.tasks[e.id]=e,this._emit(r.EventType.TASK_ADDED,e),this},r.prototype._stop=function(){this._.tickCountAfterResume=0,this._timeoutRef&&(clearTimeout(this._timeoutRef),this._timeoutRef=null),this._immediateRef&&(a.utils.clearImmediate(this._immediateRef),this._immediateRef=null)},r.prototype._reset=function(){this._={opts:(this._||{}).opts,state:r.State.IDLE,tasks:{},tickCount:0,taskRunCount:0,startTime:0,stopTime:0,completedTaskCount:0,resumeTime:0,hrResumeTime:null,tickCountAfterResume:0},this._stop()},r.prototype._taskCompleted=function(t){this._.completedTaskCount++,this._emit(r.EventType.TASK_COMPLETED,t),this._.completedTaskCount===this.taskCount&&(this._emit(r.EventType.COMPLETED),this.stopOnCompleted&&this.stop()),t.removeOnCompleted&&this.remove(t)},r.prototype._tick=function(){var t,e,n=this;this._.state=r.State.RUNNING;var i=this._.tasks;for(t in this._.tickCount++,this._.tickCountAfterResume++,this._emit(r.EventType.TICK),i)(e=i[t])&&e.canRunOnTick&&e._run(function(){n._.taskRunCount++,n._emit(r.EventType.TASK,e)});this._run()},r.prototype._markTime=function(){a.utils.BROWSER?this._.resumeTime=Date.now():this._.hrResumeTime=e.hrtime()},r.prototype._getTimeDiff=function(){if(a.utils.BROWSER)return Date.now()-this._.resumeTime;var t=e.hrtime(this._.hrResumeTime);return Math.ceil(1e3*t[0]+t[1]/1e6)},r.prototype._run=function(){var t=this;if(this.state===r.State.RUNNING){var e=this.interval;if(this.precision){var n=this._getTimeDiff();if(Math.floor(n/e)>this._.tickCountAfterResume)return void(this._immediateRef=a.utils.setImmediate(function(){return t._tick()}));e-=n%e}this._timeoutRef=setTimeout(function(){return t._tick()},e)}},r.prototype._getUniqueTaskID=function(){for(var t,e=this.taskCount;!t||this.get(t);)t="task"+ ++e;return t},r}(s.EventEmitter);f.TaskTimer=l,(n=l||(l={})).Task=u.Task,(r=n.State||(n.State={})).IDLE="idle",r.RUNNING="running",r.PAUSED="paused",r.STOPPED="stopped",(o=n.EventType||(n.EventType={})).TICK="tick",o.STARTED="started",o.RESUMED="resumed",o.PAUSED="paused",o.STOPPED="stopped",o.RESET="reset",o.TASK="task",o.TASK_ADDED="taskAdded",o.TASK_REMOVED="taskRemoved",o.TASK_COMPLETED="taskCompleted",o.TASK_ERROR="taskError",o.COMPLETED="completed",f.TaskTimer=l}).call(this,p(4))},function(t,e,n){"use strict";var i=Object.prototype.hasOwnProperty,h="~";function r(){}function u(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,n,i,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new u(n,i||t,r),s=h?h+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],o]:t._events[s].push(o):(t._events[s]=o,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(h=!1)),s.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)i.call(t,e)&&n.push(h?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},s.prototype.listeners=function(t){var e=h?h+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,o=new Array(r);i<r;i++)o[i]=n[i].fn;return o},s.prototype.listenerCount=function(t){var e=h?h+t:t,n=this._events[e];return n?n.fn?1:n.length:0},s.prototype.emit=function(t,e,n,i,r,o){var s=h?h+t:t;if(!this._events[s])return!1;var u,a,c=this._events[s],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,i),!0;case 5:return c.fn.call(c.context,e,n,i,r),!0;case 6:return c.fn.call(c.context,e,n,i,r,o),!0}for(a=1,u=new Array(l-1);a<l;a++)u[a-1]=arguments[a];c.fn.apply(c.context,u)}else{var f,p=c.length;for(a=0;a<p;a++)switch(c[a].once&&this.removeListener(t,c[a].fn,void 0,!0),l){case 1:c[a].fn.call(c[a].context);break;case 2:c[a].fn.call(c[a].context,e);break;case 3:c[a].fn.call(c[a].context,e,n);break;case 4:c[a].fn.call(c[a].context,e,n,i);break;default:if(!u)for(f=1,u=new Array(l-1);f<l;f++)u[f-1]=arguments[f];c[a].fn.apply(c[a].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,n,i){var r=h?h+t:t;if(!this._events[r])return this;if(!e)return c(this,r),this;var o=this._events[r];if(o.fn)o.fn!==e||i&&!o.once||n&&o.context!==n||c(this,r);else{for(var s=0,u=[],a=o.length;s<a;s++)(o[s].fn!==e||i&&!o[s].once||n&&o[s].context!==n)&&u.push(o[s]);u.length?this._events[r]=1===u.length?u[0]:u:c(this,r)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=h?h+t:t,this._events[e]&&c(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=h,s.EventEmitter=s,t.exports=s}])});
//# sourceMappingURL=tasktimer.min.js.map